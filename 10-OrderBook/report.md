# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: `abi.encodePacked()` Hash Collision](#h-1-abiencodepacked-hash-collision)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Unspecific Solidity Pragma](#l-2-unspecific-solidity-pragma)
  - [L-3: Public Function Not Used Internally](#l-3-public-function-not-used-internally)
  - [L-4: PUSH0 Opcode](#l-4-push0-opcode)
  - [L-5: Local Variable Shadows State Variable](#l-5-local-variable-shadows-state-variable)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 1 |
| Total nSLOC | 227 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/OrderBook.sol | 227 |
| **Total** | **227** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 1 |
| Low | 5 |


# High Issues

## H-1: `abi.encodePacked()` Hash Collision

abi.encodePacked() should not be used with dynamic types when passing the result to a hash function such as `keccak256()`. Use `abi.encode()` instead which will pad items to 32 bytes, preventing hash collisions: https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode. (e.g. `abi.encodePacked(0x123,0x456)` => `0x123456` => `abi.encodePacked(0x1,0x23456)`, but `abi.encode(0x123,0x456)` => `0x0...1230...456`). Unless there is a compelling reason, `abi.encode` should be preferred. If there is only one argument to `abi.encodePacked()` it can often be cast to `bytes()` or `bytes32()` instead: https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739. If all arguments are strings and or bytes, `bytes.concat()` should be used instead.

<details><summary>1 Found Instances</summary>


- Found in src/OrderBook.sol [Line: 246](src/OrderBook.sol#L246)

	```solidity
	            abi.encodePacked(
	```

</details>



# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>4 Found Instances</summary>


- Found in src/OrderBook.sol [Line: 23](src/OrderBook.sol#L23)

	```solidity
	contract OrderBook is Ownable {
	```

- Found in src/OrderBook.sol [Line: 272](src/OrderBook.sol#L272)

	```solidity
	    function setAllowedSellToken(address _token, bool _isAllowed) external onlyOwner {
	```

- Found in src/OrderBook.sol [Line: 279](src/OrderBook.sol#L279)

	```solidity
	    function emergencyWithdrawERC20(address _tokenAddress, uint256 _amount, address _to) external onlyOwner {
	```

- Found in src/OrderBook.sol [Line: 295](src/OrderBook.sol#L295)

	```solidity
	    function withdrawFees(address _to) external onlyOwner {
	```

</details>



## L-2: Unspecific Solidity Pragma

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

<details><summary>1 Found Instances</summary>


- Found in src/OrderBook.sol [Line: 2](src/OrderBook.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

</details>



## L-3: Public Function Not Used Internally

If a function is marked public but is not used internally, consider marking it as `external`.

<details><summary>6 Found Instances</summary>


- Found in src/OrderBook.sol [Line: 108](src/OrderBook.sol#L108)

	```solidity
	    function createSellOrder(
	```

- Found in src/OrderBook.sol [Line: 139](src/OrderBook.sol#L139)

	```solidity
	    function amendSellOrder(
	```

- Found in src/OrderBook.sol [Line: 178](src/OrderBook.sol#L178)

	```solidity
	    function cancelSellOrder(uint256 _orderId) public {
	```

- Found in src/OrderBook.sol [Line: 195](src/OrderBook.sol#L195)

	```solidity
	    function buyOrder(uint256 _orderId) public {
	```

- Found in src/OrderBook.sol [Line: 216](src/OrderBook.sol#L216)

	```solidity
	    function getOrder(uint256 _orderId) public view returns (Order memory orderDetails) {
	```

- Found in src/OrderBook.sol [Line: 221](src/OrderBook.sol#L221)

	```solidity
	    function getOrderDetailsString(uint256 _orderId) public view returns (string memory details) {
	```

</details>



## L-4: PUSH0 Opcode

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

<details><summary>1 Found Instances</summary>


- Found in src/OrderBook.sol [Line: 2](src/OrderBook.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

</details>



## L-5: Local Variable Shadows State Variable

Rename the local variable that shadows another state variable.

<details><summary>1 Found Instances</summary>


- Found in src/OrderBook.sol [Line: 86](src/OrderBook.sol#L86)

	```solidity
	    constructor(address _weth, address _wbtc, address _wsol, address _usdc, address _owner) Ownable(_owner) {
	```

</details>



